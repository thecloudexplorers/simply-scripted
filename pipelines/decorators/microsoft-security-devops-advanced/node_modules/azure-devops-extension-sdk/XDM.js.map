{"version":3,"file":"XDM.js","sources":["../src/XDM.ts"],"sourcesContent":["/**\r\n* Interface for a single XDM channel\r\n*/\r\nexport interface IXDMChannel {\r\n\r\n    /**\r\n    * Invoke a method via RPC. Lookup the registered object on the remote end of the channel and invoke the specified method.\r\n    *\r\n    * @param method - Name of the method to invoke\r\n    * @param instanceId - unique id of the registered object\r\n    * @param params - Arguments to the method to invoke\r\n    * @param instanceContextData - Optional context data to pass to a registered object's factory method\r\n    */\r\n    invokeRemoteMethod<T>(methodName: string, instanceId: string, params?: any[], instanceContextData?: Object): Promise<T>;\r\n\r\n    /**\r\n    * Get a proxied object that represents the object registered with the given instance id on the remote side of this channel.\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    * @param contextData - Optional context data to pass to a registered object's factory method\r\n    */\r\n    getRemoteObjectProxy<T>(instanceId: string, contextData?: Object): Promise<T>;\r\n\r\n    /**\r\n    * Get the object registry to handle messages from this specific channel.\r\n    * Upon receiving a message, this channel registry will be used first, then\r\n    * the global registry will be used if no handler is found here.\r\n    */\r\n    getObjectRegistry(): IXDMObjectRegistry;\r\n}\r\n\r\n/**\r\n* Registry of XDM channels kept per target frame/window\r\n*/\r\nexport interface IXDMChannelManager {\r\n\r\n    /**\r\n    * Add an XDM channel for the given target window/iframe\r\n    *\r\n    * @param window - Target iframe window to communicate with\r\n    * @param targetOrigin - Url of the target iframe (if known)\r\n    */\r\n    addChannel(window: Window, targetOrigin?: string): IXDMChannel;\r\n\r\n    /**\r\n    * Removes an XDM channel, allowing it to be disposed\r\n    *\r\n    * @param channel - The channel to remove from the channel manager\r\n    */\r\n    removeChannel(channel: IXDMChannel): void;\r\n}\r\n\r\n/**\r\n* Registry of XDM objects that can be invoked by an XDM channel\r\n*/\r\nexport interface IXDMObjectRegistry {\r\n\r\n    /**\r\n    * Register an object (instance or factory method) exposed by this frame to callers in a remote frame\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    * @param instance - Either: (1) an object instance, or (2) a function that takes optional context data and returns an object instance.\r\n    */\r\n    register(instanceId: string, instance: Object | { (contextData?: any): Object; }): void;\r\n\r\n    /**\r\n    * Unregister an object (instance or factory method) that was previously registered by this frame\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    */\r\n    unregister(instanceId: string): void;\r\n\r\n    /**\r\n    * Get an instance of an object registered with the given id\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    * @param contextData - Optional context data to pass to the contructor of an object factory method\r\n    */\r\n    getInstance<T>(instanceId: string, contextData?: Object): T | undefined;\r\n}\r\n\r\n\r\n/**\r\n* Settings related to the serialization of data across iframe boundaries.\r\n*/\r\nexport interface ISerializationSettings {\r\n\r\n    /**\r\n    * By default, properties that begin with an underscore are not serialized across\r\n    * the iframe boundary. Set this option to true to serialize such properties.\r\n    */\r\n    includeUnderscoreProperties: boolean;\r\n}\r\n\r\n/**\r\n * Represents a remote procedure call (rpc) between frames.\r\n */\r\nexport interface IJsonRpcMessage {\r\n    id: number;\r\n    instanceId?: string;\r\n    instanceContext?: Object;\r\n    methodName?: string;\r\n    params?: any[];  // if method is present then params should be present\r\n    result?: any;    // method, result, and error are mutucally exclusive.  method is set for requrests, result and error are for responses\r\n    error?: any;\r\n    handshakeToken?: string;\r\n    serializationSettings?: ISerializationSettings;\r\n}\r\n\r\nconst smallestRandom = parseInt(\"10000000000\", 36);\r\nconst maxSafeInteger: number = (<any>Number).MAX_SAFE_INTEGER || 9007199254740991;\r\n\r\n/**\r\n * Create a new random 22-character fingerprint.\r\n * @return string fingerprint\r\n */\r\nfunction newFingerprint() {\r\n    // smallestRandom ensures we will get a 11-character result from the base-36 conversion.\r\n    return Math.floor((Math.random() * (maxSafeInteger - smallestRandom)) + smallestRandom).toString(36) +\r\n        Math.floor((Math.random() * (maxSafeInteger - smallestRandom)) + smallestRandom).toString(36);\r\n}\r\n\r\n/**\r\n * Gets all own and inherited property names of the given object, excluding\r\n * those that are inherited from Object's prototype and \"constructor\".\r\n * @param obj\r\n */\r\nfunction getAllPropertyNames(obj: any) {\r\n    const properties: { [key: string]: true } = {};\r\n    while (obj && obj !== Object.prototype) {\r\n        const ownPropertyNames = Object.getOwnPropertyNames(obj);\r\n        for (const name of ownPropertyNames) {\r\n            if (name !== \"constructor\") {\r\n                properties[name] = true;\r\n            }\r\n        }\r\n        obj = Object.getPrototypeOf(obj);\r\n    }\r\n\r\n    return properties;\r\n}\r\n\r\n/**\r\n * Catalog of objects exposed for XDM\r\n */\r\nexport class XDMObjectRegistry implements IXDMObjectRegistry {\r\n\r\n    private objects: any = {};\r\n\r\n    /**\r\n    * Register an object (instance or factory method) exposed by this frame to callers in a remote frame\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    * @param instance - Either: (1) an object instance, or (2) a function that takes optional context data and returns an object instance.\r\n    */\r\n    public register(instanceId: string, instance: Object | { (contextData?: any): Object; }) {\r\n        this.objects[instanceId] = instance;\r\n    }\r\n\r\n    /**\r\n    * Unregister an object (instance or factory method) that was previously registered by this frame\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    */\r\n    public unregister(instanceId: string) {\r\n        delete this.objects[instanceId];\r\n    }\r\n\r\n    /**\r\n    * Get an instance of an object registered with the given id\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    * @param contextData - Optional context data to pass to a registered object's factory method\r\n    */\r\n    public getInstance<T>(instanceId: string, contextData?: Object): T | undefined {\r\n        var instance = this.objects[instanceId];\r\n        if (!instance) {\r\n            return undefined;\r\n        }\r\n\r\n        if (typeof instance === \"function\") {\r\n            return instance(contextData);\r\n        }\r\n        else {\r\n            return instance;\r\n        }\r\n    }\r\n}\r\n\r\nconst MAX_XDM_DEPTH = 100;\r\nlet nextChannelId = 1;\r\n\r\n/**\r\n * Represents a channel of communication between frames\\document\r\n * Stays \"alive\" across multiple funtion\\method calls\r\n */\r\nexport class XDMChannel implements IXDMChannel {\r\n\r\n    private promises: { [id: number]: { resolve: Function, reject: Function } } = {};\r\n    private postToWindow: Window;\r\n    private targetOrigin: string | undefined;\r\n    private handshakeToken: string | undefined;\r\n    private registry: XDMObjectRegistry;\r\n    private channelId: number;\r\n\r\n    private nextMessageId: number = 1;\r\n    private nextProxyId: number = 1;\r\n    private proxyFunctions: { [name: string]: Function } = {};\r\n\r\n    constructor(postToWindow: Window, targetOrigin?: string) {\r\n\r\n        this.postToWindow = postToWindow;\r\n        this.targetOrigin = targetOrigin;\r\n        this.registry = new XDMObjectRegistry();\r\n        this.channelId = nextChannelId++;\r\n\r\n        if (!this.targetOrigin) {\r\n            this.handshakeToken = newFingerprint();\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Get the object registry to handle messages from this specific channel.\r\n    * Upon receiving a message, this channel registry will be used first, then\r\n    * the global registry will be used if no handler is found here.\r\n    */\r\n    public getObjectRegistry(): IXDMObjectRegistry {\r\n        return this.registry;\r\n    }\r\n\r\n    /**\r\n    * Invoke a method via RPC. Lookup the registered object on the remote end of the channel and invoke the specified method.\r\n    *\r\n    * @param method - Name of the method to invoke\r\n    * @param instanceId - unique id of the registered object\r\n    * @param params - Arguments to the method to invoke\r\n    * @param instanceContextData - Optional context data to pass to a registered object's factory method\r\n    * @param serializationSettings - Optional serialization settings\r\n    */\r\n    public async invokeRemoteMethod<T>(methodName: string, instanceId: string, params?: any[], instanceContextData?: Object, serializationSettings?: ISerializationSettings): Promise<T> {\r\n\r\n        const message: IJsonRpcMessage = {\r\n            id: this.nextMessageId++,\r\n            methodName: methodName,\r\n            instanceId: instanceId,\r\n            instanceContext: instanceContextData,\r\n            params: <any[]>this._customSerializeObject(params, serializationSettings),\r\n            serializationSettings: serializationSettings\r\n        };\r\n\r\n        if (!this.targetOrigin) {\r\n            message.handshakeToken = this.handshakeToken;\r\n        }\r\n\r\n        const promise = new Promise<T>((resolve, reject) => {\r\n            this.promises[message.id] = { resolve, reject };\r\n        });\r\n\r\n        this._sendRpcMessage(message);\r\n\r\n        return promise;\r\n    }\r\n\r\n    /**\r\n    * Get a proxied object that represents the object registered with the given instance id on the remote side of this channel.\r\n    *\r\n    * @param instanceId - unique id of the registered object\r\n    * @param contextData - Optional context data to pass to a registered object's factory method\r\n    */\r\n    public getRemoteObjectProxy<T>(instanceId: string, contextData?: Object): Promise<T> {\r\n        return this.invokeRemoteMethod(\"\", instanceId, undefined, contextData);\r\n    }\r\n\r\n    private invokeMethod(registeredInstance: any, rpcMessage: IJsonRpcMessage) {\r\n\r\n        if (!rpcMessage.methodName) {\r\n            // Null/empty method name indicates to return the registered object itself.\r\n            this._success(rpcMessage, registeredInstance, rpcMessage.handshakeToken);\r\n            return;\r\n        }\r\n\r\n        var method: Function = registeredInstance[rpcMessage.methodName];\r\n        if (typeof method !== \"function\") {\r\n            this.error(rpcMessage, new Error(\"RPC method not found: \" + rpcMessage.methodName));\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Call specified method.  Add nested success and error call backs with closure\r\n            // so we can post back a response as a result or error as appropriate\r\n            var methodArgs = [];\r\n            if (rpcMessage.params) {\r\n                methodArgs = <any[]>this._customDeserializeObject(rpcMessage.params, {});\r\n            }\r\n\r\n            var result = method.apply(registeredInstance, methodArgs);\r\n            if (result && result.then && typeof result.then === \"function\") {\r\n                result.then((asyncResult: any) => {\r\n                    this._success(rpcMessage, asyncResult, rpcMessage.handshakeToken);\r\n                }, (e: any) => {\r\n                    this.error(rpcMessage, e);\r\n                });\r\n            }\r\n            else {\r\n                this._success(rpcMessage, result, rpcMessage.handshakeToken);\r\n            }\r\n        }\r\n        catch (exception) {\r\n            // send back as error if an exception is thrown\r\n            this.error(rpcMessage, exception as Error);\r\n        }\r\n    }\r\n\r\n    private getRegisteredObject(instanceId: string, instanceContext?: Object): Object | undefined {\r\n\r\n        if (instanceId === \"__proxyFunctions\") {\r\n            // Special case for proxied functions of remote instances\r\n            return this.proxyFunctions;\r\n        }\r\n\r\n        // Look in the channel registry first\r\n        var registeredObject = this.registry.getInstance(instanceId, instanceContext);\r\n        if (!registeredObject) {\r\n            // Look in the global registry as a fallback\r\n            registeredObject = globalObjectRegistry.getInstance(instanceId, instanceContext);\r\n        }\r\n\r\n        return registeredObject as Object;\r\n    }\r\n\r\n    /**\r\n    * Handle a received message on this channel. Dispatch to the appropriate object found via object registry\r\n    *\r\n    * @param rpcMessage - Message data\r\n    * @return True if the message was handled by this channel. Otherwise false.\r\n    */\r\n    public onMessage(rpcMessage: IJsonRpcMessage): boolean {\r\n\r\n        if (rpcMessage.instanceId) {\r\n            // Find the object that handles this requestNeed to find implementation\r\n\r\n            // Look in the channel registry first\r\n            const registeredObject: any = this.getRegisteredObject(rpcMessage.instanceId, rpcMessage.instanceContext);\r\n            if (!registeredObject) {\r\n                // If not found return false to indicate that the message was not handled\r\n                return false;\r\n            }\r\n\r\n            if (typeof registeredObject[\"then\"] === \"function\") {\r\n                (<Promise<any>>registeredObject).then((resolvedInstance) => {\r\n                    this.invokeMethod(resolvedInstance, rpcMessage);\r\n                }, (e) => {\r\n                    this.error(rpcMessage, e);\r\n                });\r\n            }\r\n            else {\r\n                this.invokeMethod(registeredObject, rpcMessage);\r\n            }\r\n        }\r\n        else {\r\n            const promise = this.promises[rpcMessage.id];\r\n            if (!promise) {\r\n                // Message not handled by this channel.\r\n                return false;\r\n            }\r\n\r\n            if (rpcMessage.error) {\r\n                promise.reject(this._customDeserializeObject([rpcMessage.error], {})[0]);\r\n            }\r\n            else {\r\n                promise.resolve(this._customDeserializeObject([rpcMessage.result], {})[0]);\r\n            }\r\n\r\n            delete this.promises[rpcMessage.id];\r\n        }\r\n\r\n        // Message handled by this channel\r\n        return true;\r\n    }\r\n\r\n    public owns(source: Window, origin: string, rpcMessage: IJsonRpcMessage): boolean {\r\n        /// Determines whether the current message belongs to this channel or not\r\n        if (this.postToWindow === source) {\r\n            // For messages coming from sandboxed iframes the origin will be set to the string \"null\".  This is \r\n            // how onprem works.  If it is not a sandboxed iFrame we will get the origin as expected.\r\n            if (this.targetOrigin) {\r\n                if (origin) {\r\n                    return origin.toLowerCase() === \"null\" || this.targetOrigin.toLowerCase().indexOf(origin.toLowerCase()) === 0;\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n            else {\r\n                if (rpcMessage.handshakeToken && rpcMessage.handshakeToken === this.handshakeToken) {\r\n                    this.targetOrigin = origin;\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public error(messageObj: IJsonRpcMessage, errorObj: Error) {\r\n        this._sendRpcMessage({\r\n            id: messageObj.id,\r\n            error: this._customSerializeObject([errorObj], messageObj.serializationSettings)[0],\r\n            handshakeToken: messageObj.handshakeToken\r\n        });\r\n    }\r\n\r\n    private _success(messageObj: IJsonRpcMessage, result: any, handshakeToken?: string) {\r\n        this._sendRpcMessage({\r\n            id: messageObj.id,\r\n            result: this._customSerializeObject([result], messageObj.serializationSettings)[0],\r\n            handshakeToken\r\n        });\r\n    }\r\n\r\n    private _sendRpcMessage(message: IJsonRpcMessage) {\r\n        this.postToWindow.postMessage(JSON.stringify(message), \"*\");\r\n    }\r\n\r\n    private _customSerializeObject(obj: Object | undefined, settings: ISerializationSettings | undefined, prevParentObjects?: { originalObjects: any[]; newObjects: any[]; }, nextCircularRefId: number = 1, depth: number = 1): any | undefined {\r\n\r\n        if (!obj || depth > MAX_XDM_DEPTH) {\r\n            return undefined;\r\n        }\r\n\r\n        if (obj instanceof Node || obj instanceof Window || obj instanceof Event) {\r\n            return undefined;\r\n        }\r\n\r\n        var returnValue: any;\r\n\r\n        let parentObjects: { originalObjects: any[]; newObjects: any[]; };\r\n        if (!prevParentObjects) {\r\n            parentObjects = {\r\n                newObjects: [],\r\n                originalObjects: []\r\n            };\r\n        }\r\n        else {\r\n            parentObjects = prevParentObjects;\r\n        }\r\n\r\n        parentObjects.originalObjects.push(obj);\r\n\r\n        var serializeMember = (parentObject: any, newObject: any, key: any) => {\r\n            var item;\r\n\r\n            try {\r\n                item = parentObject[key];\r\n            }\r\n            catch (ex) {\r\n                // Cannot access this property. Skip its serialization.\r\n            }\r\n\r\n            var itemType = typeof item;\r\n            if (itemType === \"undefined\") {\r\n                return;\r\n            }\r\n\r\n            // Check for a circular reference by looking at parent objects\r\n            var parentItemIndex = -1;\r\n            if (itemType === \"object\") {\r\n                parentItemIndex = parentObjects.originalObjects.indexOf(item);\r\n            }\r\n            if (parentItemIndex >= 0) {\r\n                // Circular reference found. Add reference to parent\r\n                var parentItem = parentObjects.newObjects[parentItemIndex];\r\n                if (!parentItem.__circularReferenceId) {\r\n                    parentItem.__circularReferenceId = nextCircularRefId++;\r\n                }\r\n                newObject[key] = {\r\n                    __circularReference: parentItem.__circularReferenceId\r\n                };\r\n            }\r\n            else {\r\n                if (itemType === \"function\") {\r\n                    var proxyFunctionId = this.nextProxyId++;\r\n                    newObject[key] = {\r\n                        __proxyFunctionId: this._registerProxyFunction(item, obj),\r\n                        _channelId: this.channelId\r\n                    };\r\n                }\r\n                else if (itemType === \"object\") {\r\n                    if (item && item instanceof Date) {\r\n                        newObject[key] = {\r\n                            __proxyDate: item.getTime()\r\n                        };\r\n                    }\r\n                    else {\r\n                        newObject[key] = this._customSerializeObject(item, settings, parentObjects, nextCircularRefId, depth + 1);\r\n                    }\r\n                }\r\n                else if (key !== \"__proxyFunctionId\") {\r\n                    // Just add non object/function properties as-is. Don't include \"__proxyFunctionId\" to protect\r\n                    // our proxy methods from being invoked from other messages.\r\n                    newObject[key] = item;\r\n                }\r\n            }\r\n        };\r\n\r\n        if (obj instanceof Array) {\r\n\r\n            returnValue = [];\r\n            parentObjects.newObjects.push(returnValue);\r\n\r\n            for (var i = 0, l = obj.length; i < l; i++) {\r\n                serializeMember(obj, returnValue, i);\r\n            }\r\n        }\r\n        else {\r\n            returnValue = {};\r\n            parentObjects.newObjects.push(returnValue);\r\n\r\n            let keys: { [key: string]: true } = {};\r\n            try {\r\n                keys = getAllPropertyNames(obj);\r\n            } catch (ex) {\r\n                // We may not be able to access the iterator of this object. Skip its serialization.\r\n            }\r\n\r\n            for (var key in keys) {\r\n                // Don't serialize properties that start with an underscore.\r\n                if ((key && key[0] !== \"_\") || (settings && settings.includeUnderscoreProperties)) {\r\n                    serializeMember(obj, returnValue, key);\r\n                }\r\n            }\r\n        }\r\n\r\n        parentObjects.originalObjects.pop();\r\n        parentObjects.newObjects.pop();\r\n\r\n        return returnValue;\r\n    }\r\n\r\n    private _registerProxyFunction(func: Function, context: any): number {\r\n        var proxyFunctionId = this.nextProxyId++;\r\n        this.proxyFunctions[\"proxy\" + proxyFunctionId] = function () {\r\n            return func.apply(context, Array.prototype.slice.call(arguments, 0));\r\n        };\r\n        return proxyFunctionId;\r\n    }\r\n\r\n    private _customDeserializeObject(obj: Object, circularRefs: { [key: number]: Object }): any {\r\n        var that = this;\r\n\r\n        if (!obj) {\r\n            return null;\r\n        }\r\n\r\n        var deserializeMember = (parentObject: any, key: any) => {\r\n            var item = parentObject[key];\r\n            var itemType = typeof item;\r\n\r\n            if (key === \"__circularReferenceId\" && itemType === 'number') {\r\n                circularRefs[item] = parentObject;\r\n                delete parentObject[key];\r\n            }\r\n            else if (itemType === \"object\" && item) {\r\n\r\n                if (item.__proxyFunctionId) {\r\n                    parentObject[key] = function () {\r\n                        return that.invokeRemoteMethod(\"proxy\" + item.__proxyFunctionId, \"__proxyFunctions\", Array.prototype.slice.call(arguments, 0), {}, { includeUnderscoreProperties: true });\r\n                    }\r\n                }\r\n                else if (item.__proxyDate) {\r\n                    parentObject[key] = new Date(item.__proxyDate);\r\n                }\r\n                else if (item.__circularReference) {\r\n                    parentObject[key] = circularRefs[item.__circularReference];\r\n                }\r\n                else {\r\n                    this._customDeserializeObject(item, circularRefs);\r\n                }\r\n            }\r\n        };\r\n\r\n        if (obj instanceof Array) {\r\n            for (var i = 0, l = obj.length; i < l; i++) {\r\n                deserializeMember(obj, i);\r\n            }\r\n        }\r\n        else if (typeof obj === \"object\") {\r\n            for (var key in obj) {\r\n                deserializeMember(obj, key);\r\n            }\r\n        }\r\n\r\n        return obj;\r\n    }\r\n}\r\n\r\n/**\r\n* Registry of XDM channels kept per target frame/window\r\n*/\r\nclass XDMChannelManager implements IXDMChannelManager {\r\n\r\n    private _channels: XDMChannel[] = [];\r\n\r\n    constructor() {\r\n        window.addEventListener(\"message\", this._handleMessageReceived);\r\n    }\r\n\r\n    /**\r\n    * Add an XDM channel for the given target window/iframe\r\n    *\r\n    * @param window - Target iframe window to communicate with\r\n    * @param targetOrigin - Url of the target iframe (if known)\r\n    */\r\n    public addChannel(window: Window, targetOrigin?: string): IXDMChannel {\r\n        const channel = new XDMChannel(window, targetOrigin);\r\n        this._channels.push(channel);\r\n        return channel;\r\n    }\r\n\r\n    public removeChannel(channel: IXDMChannel) {\r\n        this._channels = this._channels.filter(c => c !== channel);\r\n    }\r\n\r\n    private _handleMessageReceived = (event: any) => {\r\n        // get channel and dispatch to it\r\n        let rpcMessage: IJsonRpcMessage | undefined;\r\n\r\n        if (typeof event.data === \"string\") {\r\n            try {\r\n                rpcMessage = JSON.parse(event.data);\r\n            }\r\n            catch (error) {\r\n                // The message is not a valid JSON string. Not one of our events.\r\n            }\r\n        }\r\n\r\n        if (rpcMessage) {\r\n            let handled = false;\r\n            let channelOwner: XDMChannel | undefined;\r\n\r\n            for (const channel of this._channels) {\r\n                if (channel.owns(event.source, event.origin, rpcMessage)) {\r\n                    // keep a reference to the channel owner found. \r\n                    channelOwner = channel;\r\n                    handled = channel.onMessage(rpcMessage) || handled;\r\n                }\r\n            }\r\n\r\n            if (channelOwner && !handled) {\r\n                if (window.console) {\r\n                    console.error(`No handler found on any channel for message: ${JSON.stringify(rpcMessage)}`);\r\n                }\r\n\r\n                // for instance based proxies, send an error on the channel owning the message to resolve any control creation promises\r\n                // on the host frame. \r\n                if (rpcMessage.instanceId) {\r\n                    channelOwner.error(rpcMessage, new Error(`The registered object ${rpcMessage.instanceId} could not be found.`));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n* The registry of global XDM handlers\r\n*/\r\nexport const globalObjectRegistry: IXDMObjectRegistry = new XDMObjectRegistry();\r\n\r\n/**\r\n* Manages XDM channels per target window/frame\r\n*/\r\nexport const channelManager: IXDMChannelManager = new XDMChannelManager();"],"names":[],"mappings":"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"}